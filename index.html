<!-- Chosen Palette: Warm Neutrals & Earth Tones (Stone/Amber/Orange) - Evoking a sense of calm exploration and golden hour photography. -->
<!-- Application Structure Plan:
    1.  **Dashboard Overview:** A high-level summary of the trip stats.
    2.  **Interactive Timeline (The Core):** Tab-based navigation for Day 1 - Day 11.
    3.  **Photography Command Center:** Checklists for Reels/Shorts and Photo Spots.
    4.  **Logistics & Loot:** Shopping, dining, and accommodation lists.
    5.  **Gemini AI Integration:**
        * Feature A: Daily "Smart Tips" button in the itinerary card.
        * Feature B: "Photo Guide" button in the photo mission list.
    6.  **Daily Routine Checklist:** Added per user request (Running, Snacks, Beer, Fuji Cake).
-->

<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ±äº¬ & å¯Œå£«å±± 11å¤©10å¤œ ç¨æ—…æ”å½±æŒ‡æ®ä¸­å¿ƒ (AI Powered)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Markdown Parser for AI responses -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: #f5f5f4; /* stone-100 */
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        .active-tab {
            background-color: #d97706; /* amber-600 */
            color: white;
            border-color: #d97706;
        }
        .inactive-tab {
            background-color: white;
            color: #44403c; /* stone-700 */
            border-color: #e7e5e4; /* stone-200 */
        }
        .inactive-tab:hover {
            background-color: #fef3c7; /* amber-100 */
        }
        /* Custom scrollbar for horizontal tabs */
        .hide-scroll::-webkit-scrollbar {
            display: none;
        }
        .hide-scroll {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        /* AI Modal Markdown Styles */
        .prose h3 { font-size: 1.1em; font-weight: bold; margin-top: 1em; margin-bottom: 0.5em; color: #d97706; }
        .prose ul { list-style-type: disc; padding-left: 1.2em; margin-bottom: 1em; }
        .prose li { margin-bottom: 0.3em; }
        .prose strong { color: #44403c; }
        
        /* Loading Animation */
        .sparkle-loading {
            display: inline-block;
            animation: pulse-sparkle 1.5s infinite;
        }
        @keyframes pulse-sparkle {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }
    </style>
</head>
<body class="text-stone-800">

    <!-- Main Container -->
    <div class="max-w-6xl mx-auto px-4 py-8 min-h-screen flex flex-col gap-8 relative">

        <!-- Header -->
        <header class="text-center space-y-2">
            <h1 class="text-3xl md:text-4xl font-bold text-stone-900 tracking-tight">ğŸ‡¯ğŸ‡µ æ±äº¬ & å¯Œå£«å±± ç¨æ—…æ”å½±è¨ˆç•«</h1>
            <p class="text-stone-500 font-medium">2025/01/01 - 2025/01/11 (11å¤©10å¤œ) â€¢ AI éš¨èº«åŠ©ç†ç‰ˆ</p>
            <div class="flex justify-center gap-4 text-sm mt-4">
                <span class="px-3 py-1 bg-amber-100 text-amber-800 rounded-full">ğŸ“¸ æ”å½±å„ªå…ˆ</span>
                <span class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full">ğŸ—» å¯Œå£«å±±çµ•æ™¯</span>
                <span class="px-3 py-1 bg-purple-100 text-purple-800 rounded-full">âœ¨ Gemini AI è³¦èƒ½</span>
            </div>
        </header>

        <!-- Dashboard / Overview Section -->
        <section class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Intro Text -->
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-stone-200 flex flex-col justify-center">
                <h2 class="text-xl font-bold mb-4 text-amber-700">ğŸ“‹ è¡Œç¨‹ç¸½è¦½</h2>
                <p class="mb-4 text-stone-600 leading-relaxed">
                    æ­¡è¿ä¾†åˆ°æ‚¨çš„æ—…è¡ŒæŒ‡æ®ä¸­å¿ƒã€‚æœ¬è¡Œç¨‹å°ˆç‚ºæ”å½±æ„›å¥½è€…è¨­è¨ˆï¼Œæ¶µè“‹æ±äº¬çš„ç¾ä»£èˆ‡ä¸‹ç”ºé¢¨æƒ…ï¼Œä»¥åŠæ²³å£æ¹–çš„å¯Œå£«å±±çµ•æ™¯ã€‚
                    é‡é»åŒ…å« <span class="font-bold text-stone-800">1/5 ä¸­å±±é‡‘æ¯è³½é¦¬</span>ã€<span class="font-bold text-stone-800">Shibuya Sky å¤•é™½</span> èˆ‡ <span class="font-bold text-stone-800">é€†å¯Œå£«</span> æ‹æ”ã€‚
                </p>
                <div class="grid grid-cols-2 gap-4 mt-auto">
                    <div class="bg-stone-50 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-stone-800">6æ™š</div>
                        <div class="text-xs text-stone-500 uppercase">ç§‹è‘‰åŸä½å®¿</div>
                    </div>
                    <div class="bg-stone-50 p-4 rounded-lg text-center">
                        <div class="text-2xl font-bold text-stone-800">3æ™š</div>
                        <div class="text-xs text-stone-500 uppercase">æ²³å£æ¹–ä½å®¿</div>
                    </div>
                </div>
            </div>

            <!-- Chart: Trip Focus -->
            <div class="bg-white p-6 rounded-2xl shadow-sm border border-stone-200">
                <h2 class="text-xl font-bold mb-4 text-amber-700">ğŸ¯ è¡Œç¨‹é‡å¿ƒåˆ†æ</h2>
                <div class="chart-container">
                    <canvas id="focusChart"></canvas>
                </div>
                <p class="text-xs text-center text-stone-400 mt-2">æ”å½±èˆ‡æ¢ç´¢ä½”æ¯”æœ€é«˜ï¼Œè³¼ç‰©é›†ä¸­æ–¼ç‰¹å®šæ™‚æ®µã€‚</p>
            </div>
        </section>

        <!-- Navigation Tabs (Main Controller) -->
        <nav class="sticky top-2 z-40 bg-stone-100/90 backdrop-blur-sm py-2 rounded-xl border border-stone-200 shadow-md">
            <div class="flex overflow-x-auto gap-2 px-2 hide-scroll" id="dayTabs">
                <!-- JS will populate these buttons -->
            </div>
        </nav>

        <!-- Dynamic Content Section -->
        <main id="mainContent" class="min-h-[500px]">
            <!-- Content injected by JS -->
        </main>

        <!-- Secondary Charts Section -->
        <section class="bg-white p-6 rounded-2xl shadow-sm border border-stone-200">
            <h2 class="text-xl font-bold mb-2 text-stone-800">âš¡ æ¯æ—¥é«”åŠ›æ¶ˆè€—é ä¼°</h2>
            <p class="text-sm text-stone-500 mb-6">é»æ“Šä¸‹æ–¹åœ–è¡¨å¯ç›´æ¥è·³è½‰è‡³è©²æ—¥è¡Œç¨‹ã€‚</p>
            <div class="chart-container">
                <canvas id="intensityChart"></canvas>
            </div>
        </section>

        <!-- Photo Missions & Shopping Section -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            
            <!-- Photo Missions -->
            <section class="bg-white p-6 rounded-2xl shadow-sm border border-stone-200">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-bold text-stone-800">ğŸ¥ æ”å½± & Reels ä»»å‹™</h2>
                    <span id="photoProgress" class="text-sm font-bold text-amber-600 bg-amber-100 px-3 py-1 rounded-full">0/10 å®Œæˆ</span>
                </div>
                <p class="text-sm text-stone-500 mb-4">é»æ“Šé …ç›®æ¨™è¨˜å®Œæˆã€‚é»æ“Šã€Œâœ¨ æ”»ç•¥ã€ç²å– AI æ‹æ”å»ºè­°ã€‚</p>
                
                <div class="space-y-3" id="photoChecklist">
                    <!-- JS Populated -->
                </div>
            </section>

            <!-- Shopping Logistics -->
            <section class="bg-white p-6 rounded-2xl shadow-sm border border-stone-200">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-bold text-stone-800">ğŸ›ï¸ è³¼ç‰© & ä¼´æ‰‹ç¦®æ¸…å–®</h2>
                    <span id="shopProgress" class="text-sm font-bold text-blue-600 bg-blue-100 px-3 py-1 rounded-full">0/12 è³¼å…¥</span>
                </div>
                 <p class="text-sm text-stone-500 mb-4">é»æ“Šé …ç›®ä»¥æ¨™è¨˜ç‚ºã€Œå·²è³¼å…¥ã€ã€‚</p>
                <div class="space-y-3" id="shoppingChecklist">
                    <!-- JS Populated -->
                </div>
            </section>
        </div>

        <!-- Footer -->
        <footer class="text-center text-stone-400 text-sm py-8 border-t border-stone-200">
            <p>2025 Tokyo & Fuji Solo Trip â€¢ Photography Itinerary</p>
            <p class="mt-2 text-xs">Remember to check weather forecasts for Mt. Fuji visibility.</p>
        </footer>

    </div>

    <!-- AI Modal -->
    <div id="aiModal" class="fixed inset-0 bg-stone-900/50 z-50 hidden flex items-center justify-center p-4 backdrop-blur-sm transition-opacity duration-300">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-lg max-h-[80vh] flex flex-col transform transition-all scale-100">
            <!-- Modal Header -->
            <div class="p-4 border-b border-stone-100 flex justify-between items-center bg-gradient-to-r from-purple-50 to-amber-50 rounded-t-2xl">
                <div class="flex items-center gap-2">
                    <span class="text-xl">âœ¨</span>
                    <h3 id="aiModalTitle" class="font-bold text-stone-800">Gemini æ€è€ƒä¸­...</h3>
                </div>
                <button onclick="closeModal()" class="text-stone-400 hover:text-stone-600 p-1">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
            </div>
            
            <!-- Modal Body -->
            <div id="aiModalContent" class="p-6 overflow-y-auto prose prose-stone text-sm leading-relaxed text-stone-600">
                <!-- Content goes here -->
                <div class="flex flex-col items-center justify-center py-8 space-y-4">
                    <div class="sparkle-loading text-4xl">âœ¨</div>
                    <p class="text-stone-400">æ­£åœ¨åˆ†æè¡Œç¨‹èˆ‡æ”å½±æ•¸æ“š...</p>
                </div>
            </div>

            <!-- Modal Footer -->
            <div class="p-4 border-t border-stone-100 bg-stone-50 rounded-b-2xl text-right">
                <button onclick="closeModal()" class="px-4 py-2 bg-stone-800 text-white rounded-lg text-sm hover:bg-stone-700 transition-colors">
                    é—œé–‰
                </button>
            </div>
        </div>
    </div>

    <!-- JavaScript Logic -->
    <script>
        // --- 0. Gemini API Configuration & Logic ---
        const apiKey = ""; // API Key injected by environment

        async function callGeminiAPI(prompt) {
            if (!apiKey) {
                console.error("API Key is missing.");
                return "éŒ¯èª¤ï¼šAPI Key æœªè¨­å®šã€‚è«‹ç¢ºèªç’°å¢ƒè®Šæ•¸ã€‚";
            }

            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`;
            
            const payload = {
                contents: [{ parts: [{ text: prompt }] }]
            };

            const delays = [1000, 2000, 4000, 8000, 16000];
            
            for (let i = 0; i < 5; i++) {
                try {
                    const response = await fetch(url, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                         if (response.status === 429) {
                            // Retry on rate limit
                             throw new Error('Rate limit exceeded');
                         }
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }

                    const data = await response.json();
                    return data.candidates?.[0]?.content?.parts?.[0]?.text || "Gemini æ²’æœ‰å›æ‡‰å…§å®¹ã€‚";

                } catch (error) {
                    if (i === 4) return "é€£ç·šéŒ¯èª¤ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚\n\n" + error.message;
                    await new Promise(resolve => setTimeout(resolve, delays[i]));
                }
            }
        }

        // Modal Functions
        const modal = document.getElementById('aiModal');
        const modalTitle = document.getElementById('aiModalTitle');
        const modalContent = document.getElementById('aiModalContent');

        function openModal(title) {
            modalTitle.innerText = title;
            modalContent.innerHTML = `
                <div class="flex flex-col items-center justify-center py-8 space-y-4">
                    <div class="sparkle-loading text-4xl">âœ¨</div>
                    <p class="text-stone-400">Gemini æ­£åœ¨ç‚ºæ‚¨ç”Ÿæˆå»ºè­°...</p>
                </div>
            `;
            modal.classList.remove('hidden');
        }

        function closeModal() {
            modal.classList.add('hidden');
        }

        // Close modal when clicking outside
        modal.addEventListener('click', (e) => {
            if (e.target === modal) closeModal();
        });

        // Feature 1: Get Daily Tips
        async function getDailyTips(dayData) {
            openModal(`Day ${dayData.day}ï¼šAI ç§æˆ¿å»ºè­°`);
            
            const prompt = `
                ä½ æ˜¯ä¸€ä½å°ˆæ¥­çš„æ—¥æœ¬æ—…éŠæ”å½±å¸«èˆ‡å°éŠã€‚
                ä½¿ç”¨è€…å°‡åœ¨ã€${dayData.date}ã€‘å‰å¾€ã€${dayData.location}ã€‘ã€‚
                ä»Šæ—¥è¡Œç¨‹é‡é»ï¼š${dayData.highlights.join(', ')}ã€‚
                è¡Œç¨‹æ¨™ç±¤ï¼š${dayData.tag}ã€‚
                
                è«‹é‡å°é€™ä½ã€Œç¨æ—…æ”å½±å¸«ã€ï¼Œæä¾› 3 å€‹å…·é«”ä¸”å¯¦ç”¨çš„å»ºè­°ã€‚
                å»ºè­°æ–¹å‘å¯åŒ…å«ï¼š
                1. æ”å½±ï¼šæœ€ä½³æ‹æ”æ™‚æ®µæˆ–å†·é–€æ§‹åœ–è§’åº¦ã€‚
                2. è¡Œç¨‹ï¼šå¦‚ä½•é¿é–‹äººæ½®æˆ–çœåŠ›çš„äº¤é€šå»ºè­°ã€‚
                3. ç¾é£Ÿï¼šé™„è¿‘é©åˆä¸€äººç”¨é¤çš„éš±è—ç¾é£Ÿã€‚
                
                è«‹ç”¨ç¹é«”ä¸­æ–‡å›ç­”ï¼Œæ ¼å¼ä½¿ç”¨ Markdownï¼Œèªæ°£è¼•é¬†å°ˆæ¥­ï¼Œä¸¦é©ç•¶ä½¿ç”¨ emojiã€‚
            `;

            const result = await callGeminiAPI(prompt);
            modalContent.innerHTML = marked.parse(result);
        }

        // Feature 2: Get Photo Guide
        async function getPhotoGuide(missionText) {
            openModal('AI æ”å½±æ§‹åœ–è»å¸«');
            
            const prompt = `
                ä½ æ˜¯ä¸€ä½å°ˆæ¥­çš„æ”å½±å°å¸«ã€‚ä½¿ç”¨è€…æƒ³è¦æ‹æ”ä»¥ä¸‹ä¸»é¡Œï¼š
                ã€Œ${missionText}ã€
                
                è«‹æä¾›ä¸€ä»½ç°¡çŸ­çš„æ‹æ”æ”»ç•¥ (Markdown æ ¼å¼)ï¼š
                1. **æ¨è–¦ç„¦æ®µ**ï¼š(ä¾‹å¦‚ï¼šå»£è§’ 16-35mm æˆ– é•·ç„¦ 70-200mm)
                2. **æ§‹åœ–å»ºè­°**ï¼š(ä¾‹å¦‚ï¼šä¸‰åˆ†æ³•ã€å¼•å°ç·šã€åå°„)
                3. **é—œéµè¨­å®š**ï¼š(å¿«é–€é€Ÿåº¦ã€å…‰åœˆå»ºè­°ï¼Œå¦‚æœæ˜¯å¤œæ™¯è«‹ç‰¹åˆ¥èªªæ˜)
                4. **æ‹æ”æ™‚æ©Ÿ**ï¼š(ä¾‹å¦‚ï¼šè—èª¿æ™‚åˆ»ã€æ¸…æ™¨)
                
                è«‹ç”¨ç¹é«”ä¸­æ–‡å›ç­”ï¼Œé‡å°å–®äººæ—…è¡Œè€…çµ¦äºˆå¯¦ç”¨çš„å»ºè­°ã€‚
            `;

            const result = await callGeminiAPI(prompt);
            modalContent.innerHTML = marked.parse(result);
        }


        // --- 1. Data Source (Based on the Report) ---
        const itineraryData = [
            {
                day: 1,
                date: "1/1 (ä¸‰)",
                title: "æ—¥æœ¬æ©‹ãƒ»çš‡å±…ãƒ»æ–°å®¿ãƒ»éŠ€åº§",
                tag: "é«”åŠ›æŒ‘æˆ°",
                intensity: 9,
                location: "Tokyo",
                highlights: [
                    "ä¸Šåˆï¼šæ—¥æœ¬æ©‹éº’éºŸåƒ (ç¶“å…¸åœ°æ¨™)",
                    "ä¸Šåˆï¼šçš‡å±…å‰å»£å ´ & å’Œç”°å€‰å™´æ°´å…¬åœ’",
                    "åˆé¤ï¼šShake Shack éŠ€åº§",
                    "ä¸‹åˆï¼šé ˆè³€ç¥ç¤¾ (ä½ çš„åå­—éšæ¢¯)",
                    "ä¸‹åˆï¼šæ±äº¬éƒ½å»³åŒ—å±•æœ›å®¤ (æ–°å®¿å¤•é™½)",
                    "æ™šä¸Šï¼šéŠ€åº§æ­Œèˆä¼åº§å¤œæ‹ & ä¸­å¤®é€š"
                ],
                food: "Shake Shack, Blue Bottle, éŠ€åº§å‘¨é‚Šæ™šé¤",
                tips: "å…ƒæ—¦å¾ˆå¤šåº—æ²’é–‹ï¼Œç™¾è²¨å…¬å¸ä¼‘æ¯ã€‚ç¥ç¤¾äººæ½®çœ¾å¤šã€‚"
            },
            {
                day: 2,
                date: "1/2 (å››)",
                title: "ç§‹è‘‰åŸå»ºç¯‰ & æ–°å®¿è³¼ç‰©",
                tag: "æ”å½±+è³¼ç‰©",
                intensity: 6,
                location: "Tokyo",
                highlights: [
                    "09:00 ç¥ç”°è¬ä¸–æ©‹ (ç´…ç£šæ‹±é–€)",
                    "10:00 è–æ©‹ (é›»è»Šäº¤æœƒ)",
                    "11:00 2k540 é«˜æ¶æ©‹ä¸‹è·äººè¡—",
                    "åˆé¤ï¼šæ–°å®¿æ•˜æ•˜è‹‘ (é ç´„ daniel79865)",
                    "ä¸‹åˆï¼šç§‹è‘‰åŸ/æ–°å®¿ è³¼ç‰©ç‹‚æ­¡ (å‹•æ¼«å‘¨é‚Š)",
                    "æ™šä¸Šï¼šç§‹è‘‰åŸè‡ªç”±æ´»å‹•"
                ],
                food: "æ–°å®¿æ•˜æ•˜è‹‘ (ç‡’è‚‰)",
                tips: "æ—©ä¸Šé›†ä¸­æ‹æ”å»ºç¯‰ï¼Œä¸‹åˆå°ˆå¿ƒè²·æ±è¥¿ã€‚"
            },
            {
                day: 3,
                date: "1/3 (äº”)",
                title: "ä¸‹ç”ºé¢¨æƒ…ï¼šæ™´ç©ºå¡”ãƒ»æ·ºè‰ãƒ»è°·æ ¹åƒ",
                tag: "æ–‡åŒ–æ”å½±",
                intensity: 7,
                location: "Tokyo",
                highlights: [
                    "æ¸…æ™¨ï¼šåé–“æ©‹ (æ™´ç©ºå¡”å€’å½±)",
                    "ä¸Šåˆï¼šæ·ºè‰é›·é–€ (äººåŠ›è»Šç•«é¢)",
                    "ä¸‹åˆï¼šä¸Šé‡ä¹‹æ£® Sakura Terrace (æ‹è»Šç«™)",
                    "ä¸‹åˆï¼šæ±äº¬å¤§å­¸ & è°·ä¸­éŠ€åº§ã€Œå¤•é™½éšæ¢¯ã€",
                    "æ™šé¤ï¼šè‚‰å±‹æ©«ç”º (é ç´„ daniel79865)"
                ],
                food: "æ·ºè‰é°»é­šé£¯, è‚‰å±‹æ©«ç”º (å’Œç‰›åƒåˆ°é£½)",
                tips: "è°·ä¸­éŠ€åº§å¤•é™½å¿…æ‹ã€‚"
            },
            {
                day: 4,
                date: "1/4 (å…­)",
                title: "è³½é¦¬æ—¥ & ç§‹è‘‰åŸå¤œç”Ÿæ´»",
                tag: "ç†±è¡€",
                intensity: 8,
                location: "Chiba/Tokyo",
                highlights: [
                    "å…¨æ—¥ï¼šä¸­å±±ç«¶é¦¬å ´ (ä¸­å±±é‡‘æ¯ GIII)",
                    "æ‹æ”ï¼šè¬é¦¬å¥”é¨°ã€å¸•å¤šå…‹é¦¬åŒ¹ç‹€æ…‹",
                    "æ·±å¤œï¼šMOGRA (ç§‹è‘‰åŸ DJ Bar)",
                    "Option: 63 angel"
                ],
                food: "é¦¬å ´å…§Bç´šç¾é£Ÿ",
                tips: "é€±å…­æ™šä¸Šå¤œåº—æ°£æ°›æœ€ä½³ã€‚"
            },
            {
                day: 5,
                date: "1/5 (æ—¥)",
                title: "ä»£å®˜å±±ãƒ»æ¾€è°· SKY",
                tag: "æ™‚å°šè¡—æ‹",
                intensity: 6,
                location: "Tokyo",
                highlights: [
                    "ä¸Šåˆï¼šä»£å®˜å±± è”¦å±‹æ›¸åº—",
                    "ä¸‹åˆï¼šæƒ æ¯”å£½èŠ±åœ’å»£å ´å¡”",
                    "å‚æ™šï¼šSHIBUYA SKY (é ç´„å¤•é™½å ´æ¬¡)",
                    "æ™šä¸Šï¼šæ¾€è°·åå­—è·¯å£æ˜Ÿå·´å…‹",
                    "æ™šé¤ï¼šTerumae å±…é…’å±‹"
                ],
                food: "ç‚¸ç‰›æ’ Gyukatsu Motomura, Terumae",
                tips: "Shibuya Sky å‹™å¿…æå‰ä¸€å€‹æœˆæ¶ç¥¨ã€‚"
            },
            {
                day: 6,
                date: "1/6 (ä¸€)",
                title: "éº»å¸ƒå°ãƒ»æ±äº¬å¡”",
                tag: "è—è¡“çµ•æ™¯",
                intensity: 5,
                location: "Tokyo",
                highlights: [
                    "ä¸Šåˆï¼šteamLab Borderless (éº»å¸ƒå°Hills)",
                    "æ‹æ”ï¼šç¥è°·ç”ºè»Šç«™å‡ºå£æ›²ç·š",
                    "æ‹æ”ï¼šèŠå…¬åœ’ (æ±äº¬éµå¡”)",
                    "æ·±å¤œï¼šLive House"
                ],
                food: "é›æ¹¯æ‹‰éºµ ç¯",
                tips: "teamLab å»ºè­°é ç´„ä¸Šåˆå ´æ¬¡ã€‚"
            },
            {
                day: 7,
                date: "1/7 (äºŒ)",
                title: "ç§»å‹•æ—¥ï¼šæ±äº¬ â†’ æ²³å£æ¹–",
                tag: "ç§»å‹•/é¢¨æ™¯",
                intensity: 4,
                location: "Fuji",
                highlights: [
                    "ä¸Šåˆï¼šç§»å‹• (å¯Œå£«å›éŠ/å·´å£«)",
                    "åˆé¤ï¼šç‚¸ç‰›æ’ Koushuya (æ²³å£æ¹–åº—)",
                    "ä¸‹åˆï¼šæ–°å€‰å±±æ·ºé–“å…¬åœ’ (å¿ éˆå¡”+å¯Œå£«å±±)",
                    "æ‹æ”ï¼šæœ¬ç”ºäºŒä¸ç›®å•†åº—è¡—"
                ],
                food: "ç‚¸ç‰›æ’ Koushuya",
                tips: "æ–°å€‰å±±æ·ºé–“å…¬åœ’éœ€çˆ¬398éšæ¢¯ã€‚"
            },
            {
                day: 8,
                date: "1/8 (ä¸‰)",
                title: "æ²³å£æ¹–ç’°æ¹–æ”å½±",
                tag: "è‡ªç„¶é¢¨å…‰",
                intensity: 7,
                location: "Fuji",
                highlights: [
                    "æ¸…æ™¨ï¼šæ¹–ç•”æ—¥å‡º (é€†å¯Œå£« - é•·å´å…¬åœ’/ç”¢å±‹å´)",
                    "æ™¯é»ï¼šå¤§çŸ³å…¬åœ’ (èŠ±æµ·+å¯Œå£«å±±)",
                    "æ™¯é»ï¼šéŸ³æ¨‚ç›’ä¹‹æ£®ç¾è¡“é¤¨",
                    "æ™¯é»ï¼šå¤©ä¸Šå±±çºœè»Š (Kachi Kachi Ropeway)"
                ],
                food: "æ²³å£æ¹–å‘¨é‚Š",
                tips: "é€†å¯Œå£«éœ€è¦ç„¡é¢¨ç„¡é›¨çš„æ¸…æ™¨ã€‚"
            },
            {
                day: 9,
                date: "1/9 (å››)",
                title: "å¿é‡å…«æµ·",
                tag: "å‚³çµ±å»ºç¯‰",
                intensity: 5,
                location: "Fuji",
                highlights: [
                    "å…¨æ—¥ï¼šå¿é‡å…«æµ·",
                    "æ‹æ”ï¼šé¡æ±  (é€†å¯Œå£«)ã€æ¹§æ± ",
                    "æ‹æ”ï¼šå‚³çµ±èŒ…è‘ºå±‹é ‚å»ºç¯‰"
                ],
                food: "å¿é‡å…«æµ·å°åƒ",
                tips: "éŠå®¢æ¥µå¤šï¼Œå»ºè­°9é»å‰æŠµé”ã€‚"
            },
            {
                day: 10,
                date: "1/10 (äº”)",
                title: "å¯Œå£«æ€¥ãƒ»å›æ±äº¬",
                tag: "éŠæ¨‚/ç§»å‹•",
                intensity: 6,
                location: "Fuji/Tokyo",
                highlights: [
                    "ä¸Šåˆï¼šå¯Œå£«è¦‹æ©‹ (å¯Œå£«å±±é“è·¯ç›¡é ­æ„Ÿ)",
                    "ä¸Šåˆï¼šFuji-Q å¯Œå£«æ€¥æ¨‚åœ’",
                    "å‚æ™šï¼šç§»å‹•å›æ±äº¬ (ä½è’²ç”°/ç¾½ç”°)"
                ],
                food: "å¯Œå£«æ€¥æ¨‚åœ’é¤å»³",
                tips: "ä½æ©Ÿå ´é™„è¿‘æ–¹ä¾¿éš”å¤©æ—©ç­æ©Ÿã€‚"
            },
            {
                day: 11,
                date: "1/11 (å…­)",
                title: "å›ç¨‹",
                tag: "è¿”å®¶",
                intensity: 2,
                location: "Airport",
                highlights: [
                    "ä¸Šåˆï¼šç¾½ç”°æ©Ÿå ´ (HND) -> å°åŒ— (TPE)",
                    "æœ€å¾Œè¡åˆºï¼šæ©Ÿå ´ä¼´æ‰‹ç¦® (æ±äº¬é¦™è•‰ã€è–¯æ¢ä¸‰å…„å¼Ÿ)"
                ],
                food: "é£›æ©Ÿé¤",
                tips: "æ³¨æ„é›»è»Šé¦–ç­è»Šæ™‚é–“ã€‚"
            }
        ];

        const photoMissions = [
            { id: 1, text: "Day 1: éŠ€åº§/æœ‰æ¨‚ç”º è»Šè»Œå¤œæ™¯ (é•·æ›å…‰)", type: "Photo" },
            { id: 2, text: "Day 2: è–æ©‹ ä¸‰ç·šé›»è»Šäº¤æœƒ", type: "Photo" },
            { id: 3, text: "Day 3: åé–“æ©‹ æ™´ç©ºå¡”å®Œç¾å€’å½±", type: "Photo" },
            { id: 4, text: "Day 3: è°·ä¸­éŠ€åº§ å¤•é™½éšæ¢¯å‰ªå½±", type: "Photo" },
            { id: 5, text: "Day 4: ä¸­å±±ç«¶é¦¬å ´ è¬é¦¬å¥”é¨° (Panning)", type: "Photo" },
            { id: 6, text: "Day 5: SHIBUYA SKY ç™¾è¬å¤œæ™¯ (æ¶ˆåå…‰)", type: "Photo" },
            { id: 7, text: "Day 6: teamLab Borderless äººåƒå‰ªå½±", type: "Photo" },
            { id: 8, text: "Day 6: èŠå…¬åœ’ ç´…ç™½æ±äº¬éµå¡”", type: "Photo" },
            { id: 9, text: "Day 7: ä¸‹å‰ç”° æœ¬ç”ºäºŒä¸ç›® é•·ç„¦å£“ç¸®æ„Ÿ", type: "Photo" },
            { id: 10, text: "Day 8: æ²³å£æ¹– é€†å¯Œå£« (æ¸…æ™¨)", type: "Photo" },
            { id: 11, text: "Reel: 'The Next Station is Tokyo' (15å¼µè¸©é»)", type: "Video" },
            { id: 12, text: "Reel: Shibuya Sky x å¤©æ°£ä¹‹å­ (POV)", type: "Video" }
        ];

        const shoppingList = [
            { item: "çŒ©çŒ©ä¹‹æ¡ (ç›¸æ©Ÿè…³æ¶)", loc: "Yodobashi Akiba", cat: "Gear" },
            { item: "æ¸›è‚¥è—¥ (Onaka/Naishi)", loc: "æ¾æœ¬æ¸…/OS Drug", cat: "Drugstore" },
            { item: "è€åª½çš„èƒŒå¿ƒ", loc: "Uniqlo éŠ€åº§/Montbell", cat: "Clothing" },
            { item: "New York Perfect Cheese", loc: "æ±äº¬ç«™/æ–°å®¿", cat: "Souvenir" },
            { item: "ç™½è‰²æˆ€äºº", loc: "æ©Ÿå ´/æ—¥æœ¬æ©‹", cat: "Souvenir" },
            { item: "Royce ç”Ÿå·§å…‹åŠ›", loc: "æ©Ÿå ´", cat: "Souvenir" },
            { item: "YoroshiåŒ–ç²§å ‚ 365è­·å”‡è†", loc: "æ·ºè‰", cat: "Souvenir" },
            { item: "FUJIYAMA COOKIE", loc: "æ²³å£æ¹–", cat: "Souvenir" },
            { item: "LAWSON è‰è“ç‰›å¥¶", loc: "ä¾¿åˆ©å•†åº—", cat: "Daily Eat" },
            { item: "OHAYO ç„¦ç³–çƒ¤å¸ƒè•¾å†°æ·‡æ·‹", loc: "ä¾¿åˆ©å•†åº—", cat: "Daily Eat" },
            { item: "æ¯æ™šä¸€ç½å•¤é…’", loc: "ä¾¿åˆ©å•†åº—", cat: "Daily Eat" },
            { item: "Sweet Gardenå¯Œå£«é›ªç²‰èµ·å£«è›‹ç³•", loc: "æ²³å£æ¹–", cat: "Daily Eat" }
        ];
        
        // --- Daily Routine Items Definition ---
        const dailyRoutineItems = [
            { id: 'run', text: 'æ™¨é–“è·‘æ­¥ / æ•£æ­¥', icon: 'ğŸƒ', isFujiOnly: false },
            { id: 'milk', text: 'LAWSON è‰è“ç‰›å¥¶', icon: 'ğŸ“', isFujiOnly: false },
            { id: 'icecream', text: 'OHAYO ç„¦ç³–çƒ¤å¸ƒè•¾å†°æ·‡æ·‹', icon: 'ğŸ®', isFujiOnly: false },
            { id: 'beer', text: 'å–ä¸€ç½å•¤é…’', icon: 'ğŸº', isFujiOnly: false },
            { id: 'fuji_cake', text: 'Sweet Gardenå¯Œå£«é›ªç²‰èµ·å£«è›‹ç³•', icon: 'ğŸ—»', isFujiOnly: true }
        ];

        // --- 2. Core Interaction Logic ---

        // State
        let currentDayIndex = 0;
        let checkedPhotos = new Set();
        let checkedShop = new Set();
        // New State for Daily Routine: Keyed by "dayIndex_itemId" -> boolean
        let dailyRoutineState = {};

        // DOM Elements
        const dayTabs = document.getElementById('dayTabs');
        const mainContent = document.getElementById('mainContent');
        const photoChecklist = document.getElementById('photoChecklist');
        const shoppingChecklist = document.getElementById('shoppingChecklist');
        const photoProgress = document.getElementById('photoProgress');
        const shopProgress = document.getElementById('shopProgress');

        // Initialize Application
        function init() {
            // Load state from local storage (simulate simple persistence within session)
            const savedRoutine = localStorage.getItem('dailyRoutineState');
            if (savedRoutine) dailyRoutineState = JSON.parse(savedRoutine);

            renderTabs();
            renderContent(0);
            renderCharts();
            renderChecklists();
        }

        // Render Tabs
        function renderTabs() {
            dayTabs.innerHTML = '';
            itineraryData.forEach((day, index) => {
                const btn = document.createElement('button');
                btn.className = `flex-shrink-0 px-5 py-2 rounded-lg text-sm font-medium transition-all duration-200 border ${index === currentDayIndex ? 'active-tab shadow-md' : 'inactive-tab'}`;
                btn.textContent = `Day ${day.day}`;
                btn.onclick = () => {
                    currentDayIndex = index;
                    renderTabs();
                    renderContent(index);
                };
                dayTabs.appendChild(btn);
            });
        }

        // Render Content (The detailed day view)
        function renderContent(index) {
            const data = itineraryData[index];
            const isFujiArea = data.location === 'Fuji' || data.location.includes('Fuji');
            
            // Animation for transition
            mainContent.style.opacity = '0';
            
            setTimeout(() => {
                // Generate Daily Routine HTML
                let routineHtml = '';
                dailyRoutineItems.forEach(item => {
                    // Skip if item is Fuji only but we are not in Fuji
                    if (item.isFujiOnly && !isFujiArea) return;
                    
                    const stateKey = `${index}_${item.id}`;
                    const isChecked = dailyRoutineState[stateKey] || false;
                    
                    routineHtml += `
                        <div class="flex items-center gap-3 p-3 mb-2 rounded-lg cursor-pointer transition-all ${isChecked ? 'bg-green-50 border border-green-200' : 'bg-white border border-stone-200 hover:border-stone-400'}" 
                             onclick="toggleRoutine(${index}, '${item.id}')">
                            <div class="w-5 h-5 flex items-center justify-center rounded border ${isChecked ? 'bg-green-500 border-green-500 text-white' : 'border-stone-300'}">
                                ${isChecked ? 'âœ“' : ''}
                            </div>
                            <div class="flex-1 text-sm font-medium ${isChecked ? 'text-stone-400 line-through' : 'text-stone-700'}">
                                <span class="mr-1">${item.icon}</span> ${item.text}
                            </div>
                        </div>
                    `;
                });

                mainContent.innerHTML = `
                    <div class="bg-white rounded-3xl shadow-lg border border-stone-200 overflow-hidden relative">
                        <!-- Hero Header for the Card -->
                        <div class="p-8 ${isFujiArea ? 'bg-gradient-to-r from-blue-50 to-indigo-50' : 'bg-gradient-to-r from-amber-50 to-orange-50'}">
                            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
                                <div>
                                    <h2 class="text-3xl font-bold text-stone-800 mb-2">${data.date} ${data.title}</h2>
                                    <div class="flex gap-2">
                                        <span class="px-3 py-1 text-xs font-bold uppercase tracking-wide rounded-full bg-white text-stone-600 border border-stone-200">
                                            ğŸ“ ${data.location}
                                        </span>
                                        <span class="px-3 py-1 text-xs font-bold uppercase tracking-wide rounded-full ${data.intensity >= 8 ? 'bg-red-100 text-red-700' : 'bg-green-100 text-green-700'}">
                                            âš¡ å¼·åº¦: ${data.intensity}/10
                                        </span>
                                        <span class="px-3 py-1 text-xs font-bold uppercase tracking-wide rounded-full bg-stone-800 text-white">
                                            ${data.tag}
                                        </span>
                                    </div>
                                </div>
                                
                                <!-- AI Button -->
                                <div>
                                    <button 
                                        onclick="getDailyTips(itineraryData[${index}])"
                                        class="flex items-center gap-2 bg-white/80 hover:bg-white text-purple-700 px-4 py-2 rounded-xl shadow-sm border border-purple-200 transition-all hover:shadow-md backdrop-blur-sm"
                                    >
                                        <span class="text-lg">âœ¨</span>
                                        <span class="font-bold text-sm">æœ¬æ—¥ç§æˆ¿å»ºè­°</span>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div class="p-8">
                            <!-- Layout Grid: Highlights (Left) & Daily Routine (Right) -->
                            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-8">
                                
                                <!-- Column 1: Highlights (Takes up 2/3 space) -->
                                <div class="lg:col-span-2">
                                    <h3 class="text-lg font-bold text-stone-700 mb-4 border-b pb-2 border-stone-100">è¡Œç¨‹äº®é»</h3>
                                    <ul class="space-y-4">
                                        ${data.highlights.map(item => `
                                            <li class="flex items-start gap-3">
                                                <span class="mt-1.5 w-2 h-2 rounded-full ${item.includes('æ‹æ”') ? 'bg-red-500' : 'bg-amber-500'} flex-shrink-0"></span>
                                                <span class="text-stone-700 leading-relaxed">${item}</span>
                                            </li>
                                        `).join('')}
                                    </ul>
                                </div>

                                <!-- Column 2: Daily Routine (Takes up 1/3 space) -->
                                <div class="bg-stone-50 rounded-2xl p-5 border border-stone-100">
                                    <h3 class="text-sm font-bold text-stone-500 uppercase mb-3 flex items-center gap-2">
                                        <span>ğŸ“…</span> æ¯æ—¥å„€å¼ Checklist
                                    </h3>
                                    <div class="flex flex-col">
                                        ${routineHtml}
                                    </div>
                                    <p class="text-xs text-stone-400 mt-2 text-center">è®“æ¯ä¸€å¤©éƒ½æœ‰å°ç¢ºå¹¸ï¼</p>
                                </div>
                            </div>

                            <!-- Footer Info Grid -->
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div class="bg-stone-50 p-4 rounded-xl">
                                    <h4 class="text-sm font-bold text-stone-500 uppercase mb-2">ğŸ½ï¸ é¤é£² & é ç´„</h4>
                                    <p class="text-stone-800 font-medium">${data.food}</p>
                                </div>
                                <div class="bg-amber-50 p-4 rounded-xl">
                                    <h4 class="text-sm font-bold text-amber-600 uppercase mb-2">ğŸ’¡ æ”å½±ç­†è¨˜ / è²¼å¿ƒæé†’</h4>
                                    <p class="text-stone-800 text-sm">${data.tips}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                mainContent.style.opacity = '1';
                mainContent.style.transition = 'opacity 0.3s ease-in-out';
            }, 50);
        }
        
        // Toggle Routine Logic
        window.toggleRoutine = function(dayIndex, itemId) {
            const stateKey = `${dayIndex}_${itemId}`;
            dailyRoutineState[stateKey] = !dailyRoutineState[stateKey];
            
            // Persist
            localStorage.setItem('dailyRoutineState', JSON.stringify(dailyRoutineState));
            
            // Re-render specific day to show updated checkbox
            renderContent(dayIndex);
        };

        // Render Checklists
        function renderChecklists() {
            // Photo List
            photoChecklist.innerHTML = '';
            photoMissions.forEach((item, idx) => {
                const isChecked = checkedPhotos.has(idx);
                const div = document.createElement('div');
                div.className = `flex items-center justify-between gap-3 p-3 rounded-lg border transition-all ${isChecked ? 'bg-stone-50 border-stone-200' : 'bg-white border-stone-100 hover:border-amber-300 hover:shadow-sm'}`;
                
                div.innerHTML = `
                    <div class="flex items-center gap-3 cursor-pointer flex-grow" onclick="togglePhoto(${idx})">
                        <div class="w-5 h-5 rounded border flex items-center justify-center flex-shrink-0 ${isChecked ? 'bg-amber-500 border-amber-500 text-white' : 'border-stone-300'}">
                            ${isChecked ? 'âœ“' : ''}
                        </div>
                        <div>
                            <div class="text-sm font-medium ${isChecked ? 'line-through text-stone-400' : 'text-stone-700'}">${item.text}</div>
                            <div class="text-xs text-stone-400">${item.type}</div>
                        </div>
                    </div>
                    
                    <!-- AI Hint Button -->
                    <button onclick="getPhotoGuide('${item.text}')" class="text-purple-500 hover:text-purple-700 hover:bg-purple-50 p-1.5 rounded-md text-xs font-bold border border-transparent hover:border-purple-200 transition-colors flex items-center gap-1">
                        âœ¨ <span class="hidden sm:inline">æ”»ç•¥</span>
                    </button>
                `;
                photoChecklist.appendChild(div);
            });
            photoProgress.textContent = `${checkedPhotos.size}/${photoMissions.length} å®Œæˆ`;

            // Shopping List
            shoppingChecklist.innerHTML = '';
            shoppingList.forEach((item, idx) => {
                const isChecked = checkedShop.has(idx);
                const div = document.createElement('div');
                div.className = `flex items-center gap-3 p-3 rounded-lg border cursor-pointer transition-all ${isChecked ? 'bg-stone-50 border-stone-200 opacity-60' : 'bg-white border-stone-100 hover:border-blue-300 hover:shadow-sm'}`;
                div.onclick = () => toggleShop(idx);
                div.innerHTML = `
                    <div class="w-5 h-5 rounded border flex items-center justify-center ${isChecked ? 'bg-blue-500 border-blue-500 text-white' : 'border-stone-300'}">
                        ${isChecked ? 'âœ“' : ''}
                    </div>
                    <div>
                        <div class="text-sm font-medium ${isChecked ? 'line-through text-stone-400' : 'text-stone-700'}">${item.item}</div>
                        <div class="text-xs text-stone-400">${item.loc} â€¢ ${item.cat}</div>
                    </div>
                `;
                shoppingChecklist.appendChild(div);
            });
            shopProgress.textContent = `${checkedShop.size}/${shoppingList.length} è³¼å…¥`;
        }

        function togglePhoto(idx) {
            if (checkedPhotos.has(idx)) checkedPhotos.delete(idx);
            else checkedPhotos.add(idx);
            renderChecklists();
        }

        function toggleShop(idx) {
            if (checkedShop.has(idx)) checkedShop.delete(idx);
            else checkedShop.add(idx);
            renderChecklists();
        }

        // --- 3. Chart Implementation ---
        function renderCharts() {
            // Chart 1: Trip Focus (Donut)
            const ctxFocus = document.getElementById('focusChart').getContext('2d');
            new Chart(ctxFocus, {
                type: 'doughnut',
                data: {
                    labels: ['æ”å½± (Photography)', 'è³¼ç‰© (Shopping)', 'ç¾é£Ÿ (Dining)', 'ç§»å‹• (Transit)', 'è³½é¦¬/å¨›æ¨‚ (Ent)'],
                    datasets: [{
                        data: [45, 15, 20, 10, 10], // Estimated weights based on text
                        backgroundColor: ['#d97706', '#3b82f6', '#10b981', '#6b7280', '#8b5cf6'],
                        borderWidth: 0
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'right' }
                    }
                }
            });

            // Chart 2: Daily Intensity (Bar)
            const ctxIntensity = document.getElementById('intensityChart').getContext('2d');
            new Chart(ctxIntensity, {
                type: 'bar',
                data: {
                    labels: itineraryData.map(d => `Day ${d.day}`),
                    datasets: [{
                        label: 'é«”åŠ›æ¶ˆè€—å¼·åº¦ (1-10)',
                        data: itineraryData.map(d => d.intensity),
                        backgroundColor: itineraryData.map(d => d.intensity >= 8 ? '#f87171' : (d.intensity >= 6 ? '#fbbf24' : '#34d399')),
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { beginAtZero: true, max: 10 }
                    },
                    onClick: (e, elements) => {
                        if (elements.length > 0) {
                            const index = elements[0].index;
                            currentDayIndex = index;
                            renderTabs();
                            renderContent(index);
                            // Smooth scroll to content
                            mainContent.scrollIntoView({ behavior: 'smooth' });
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                afterLabel: function(context) {
                                    return itineraryData[context.dataIndex].title;
                                }
                            }
                        }
                    }
                }
            });
        }

        // Start
        init();

    </script>
</body>
</html>
